<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>F√©licitations</title>
<style>
  body {
    background:#0a0a0a;
    color:#eaeaea;
    font-family:'Cormorant Garamond',serif;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    padding:2rem;
    min-height:100vh;
    text-align:center;
  }
  input, button {
    margin-top:1rem;
    background:none;
    border:1px solid #eaeaea;
    color:#eaeaea;
    padding:8px;
    border-radius:8px;
    font-size:1rem;
    cursor:pointer;
  }
  input {
    width: 300px;
  }
  button:hover {
    background: #eaeaea;
    color: #0a0a0a;
    transition: all 0.3s ease;
  }
  ul {
    margin-top:2rem; 
    list-style:none; 
    padding:0; 
    width:100%; 
    max-width:600px; 
    min-height: 300px;
  }
  li {
    margin-bottom:1rem; 
    border:1px solid #555; 
    padding:1rem;
    background: rgba(255,255,255,0.03);
    border-radius: 8px;
    font-size: 1.1rem;
    line-height: 1.5;
    text-align: left;
    opacity: 0;
    animation: fadeIn 1s ease-in forwards;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  li.fadeOut {
    animation: fadeOut 1s ease-out forwards;
  }
  @keyframes fadeOut {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(-10px); }
  }
  audio {margin-top:2rem;}
  .poeme {
    font-style: italic;
    margin: 2rem 0;
    max-width: 500px;
    line-height: 1.6;
  }
</style>
</head>
<body>

<h2>Congradulations, you decoded the secret of dreams</h2>
<p class="poeme">In the silence of a stary night,<br>
Dreams dance, light and in flight<br>
Whispering forgotten secrets,<br>
At the heart of the soul, they are sacred"</p>

<h3>Write your dream</h3>
<input type="text" id="message" placeholder="Your dream...">
<button id="envoyerBtn">Send</button>

<ul id="mur"></ul>

<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// Configuration Supabase
const supabaseUrl = "https://dlmqycqcipetssvrnbpz.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsbXF5Y3FjaXBldHNzdnJuYnB6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA0NjAxMDUsImV4cCI6MjA3NjAzNjEwNX0.7TwdUsg4bEPzF0v1QzXMeSIvX6nlFg4XzWmuEzFf5Iw";

const { createClient } = supabase;
const supabaseClient = createClient(supabaseUrl, supabaseKey);

// Variables pour la rotation des messages
let tousLesMessages = [];
let indexActuel = 0;
const MESSAGES_PAR_PAGE = 5; // Nombre de messages affich√©s √† la fois
const DUREE_AFFICHAGE = 8000; // 8 secondes par page

// Fonction pour ajouter un message
async function ajouterMessage() {
  const texte = document.getElementById("message").value.trim();
  if(!texte) return;

  console.log("üì§ Envoi du message:", texte);

  const { data, error } = await supabaseClient
    .from('Wall_of_Dreams')
    .insert([{ My_message: texte }]);

  if(error){
    console.error("‚ùå Erreur insertion:", error);
    alert("Erreur : " + error.message);
  } else {
    console.log("‚úÖ Message ajout√© avec succ√®s");
    document.getElementById("message").value = "";
    // Recharger tous les messages pour inclure le nouveau
    chargerMessages();
  }
}

// Fonction pour charger les messages
async function chargerMessages() {
  console.log("üîç Tentative de chargement des messages...");
  
  try {
    const { data, error } = await supabaseClient
      .from('Wall_of_Dreams')
      .select('My_message, Created_at')
      .order('Created_at', { ascending: false }); // Plus r√©cents d'abord

    if(error){
      console.error("‚ùå Erreur chargement:", error);
      console.error("‚ùå D√©tails:", JSON.stringify(error, null, 2));
      document.getElementById("mur").innerHTML = "<li style='color:red;'>Erreur: " + error.message + "</li>";
      return;
    }

    console.log("‚úÖ Donn√©es re√ßues:", data);
    tousLesMessages = data || [];
    
    if(tousLesMessages.length > 0) {
      console.log("üìù Total de", tousLesMessages.length, "message(s)");
      indexActuel = 0; // R√©initialiser l'index
      afficherPageMessages();
      // D√©marrer la rotation automatique (seulement au premier chargement)
      if(!window.rotationDemarree) {
        window.rotationDemarree = true;
        setInterval(afficherPageSuivante, DUREE_AFFICHAGE);
      }
    } else {
      console.log("‚ö†Ô∏è Aucune donn√©e trouv√©e");
      document.getElementById("mur").innerHTML = "<li style='text-align:center; font-style:italic;'>Aucun r√™ve partag√© pour le moment...</li>";
    }
  } catch(err) {
    console.error("üí• Exception:", err);
    document.getElementById("mur").innerHTML = "<li style='color:red;'>Erreur technique: " + err.message + "</li>";
  }
}

// Afficher une page de messages
function afficherPageMessages() {
  const mur = document.getElementById("mur");
  mur.innerHTML = "";
  
  const debut = indexActuel;
  const fin = Math.min(indexActuel + MESSAGES_PAR_PAGE, tousLesMessages.length);
  
  for(let i = debut; i < fin; i++) {
    const li = document.createElement("li");
    li.innerText = tousLesMessages[i].My_message;
    mur.appendChild(li);
  }
}

// Passer √† la page suivante avec animation
function afficherPageSuivante() {
  if(tousLesMessages.length === 0) return;
  
  // Ajouter l'animation de sortie
  const items = document.querySelectorAll("#mur li");
  items.forEach(item => item.classList.add("fadeOut"));
  
  // Attendre la fin de l'animation puis changer les messages
  setTimeout(() => {
    indexActuel += MESSAGES_PAR_PAGE;
    
    // Revenir au d√©but si on a atteint la fin
    if(indexActuel >= tousLesMessages.length) {
      indexActuel = 0;
    }
    
    afficherPageMessages();
  }, 1000); // Dur√©e de l'animation fadeOut
}

// Associer le bouton √† la fonction
document.getElementById("envoyerBtn").addEventListener("click", ajouterMessage);

// Permettre l'envoi avec la touche Entr√©e
document.getElementById("message").addEventListener("keypress", function(e) {
  if(e.key === "Enter") {
    ajouterMessage();
  }
});

// Charger les messages au d√©marrage
chargerMessages();
</script>
</body>
</html>